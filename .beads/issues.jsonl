{"id":"ucmt-0en","title":"Schema Validator: DB vs YAML comparison after apply","description":"TDD tests (write FIRST): test_validate_passes_when_db_matches_yaml, test_validate_fails_on_missing_column, test_validate_fails_on_type_mismatch, test_validate_fails_on_missing_table, test_validate_ignores_extra_system_tables, test_validate_ignores_comment_differences, test_validate_returns_validation_result. ValidationIssue dataclass: table (Optional[str]), column (Optional[str]), kind (Literal['missing_table','missing_column','type_mismatch','constraint_mismatch']), message (str). ValidationResult dataclass: ok (bool), issues (list[ValidationIssue]). ok=True iff issues empty. CLI uses ok for exit code (0 if ok, 1 otherwise). Uses Config/DatabricksClient like other DB operations.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-13T23:21:35.962247-05:00","updated_at":"2025-12-14T00:43:39.425903-05:00","closed_at":"2025-12-14T00:43:39.425903-05:00","dependencies":[{"issue_id":"ucmt-0en","depends_on_id":"ucmt-vxw","type":"blocks","created_at":"2025-12-13T23:21:38.795175-05:00","created_by":"daemon"},{"issue_id":"ucmt-0en","depends_on_id":"ucmt-0z4","type":"blocks","created_at":"2025-12-13T23:21:41.346372-05:00","created_by":"daemon"},{"issue_id":"ucmt-0en","depends_on_id":"ucmt-2i4","type":"blocks","created_at":"2025-12-13T23:21:44.035748-05:00","created_by":"daemon"}]}
{"id":"ucmt-0my","title":"Validate column references exist in table","description":"Validate that columns referenced in primary_key, liquid_clustering, and partitioned_by actually exist in the table's columns list. Raise SchemaLoadError with clear message listing unknown column names. TDD tests: test_loader_pk_unknown_column_raises, test_loader_liquid_clustering_unknown_column_raises, test_loader_partitioned_by_unknown_column_raises.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-14T00:23:56.037475-05:00","updated_at":"2025-12-14T00:23:56.037475-05:00","dependencies":[{"issue_id":"ucmt-0my","depends_on_id":"ucmt-4ix","type":"blocks","created_at":"2025-12-14T17:07:23.996796-05:00","created_by":"daemon"}]}
{"id":"ucmt-0z4","title":"Schema Introspector (schema/introspect.py): Read schema from Unity Catalog","description":"TDD tests (write FIRST): test_introspect_users_table_matches_yaml_model, test_introspect_table_properties_includes_column_mapping, test_introspect_primary_key, test_introspect_check_constraints, test_introspect_liquid_clustering, test_introspect_ignores_views, test_introspect_ignores_temp_tables, test_introspect_missing_table_returns_none, test_introspect_normalizes_types_to_uppercase. SchemaIntrospector uses DatabricksClient (not SparkSession) to query information_schema. Tests mock DatabricksClient. Normalize types to uppercase. Ignore non-Delta tables (views, streaming, temp).","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-13T23:17:16.471041-05:00","updated_at":"2025-12-14T00:34:29.653439-05:00","closed_at":"2025-12-14T00:34:29.653439-05:00","dependencies":[{"issue_id":"ucmt-0z4","depends_on_id":"ucmt-yfk","type":"blocks","created_at":"2025-12-13T23:17:19.240594-05:00","created_by":"daemon"},{"issue_id":"ucmt-0z4","depends_on_id":"ucmt-12f","type":"blocks","created_at":"2025-12-13T23:17:21.884339-05:00","created_by":"daemon"}]}
{"id":"ucmt-12f","title":"Databricks Client (databricks/client.py): SQL execution wrapper","description":"TDD tests (write FIRST): test_client_executes_sql, test_client_raises_on_sql_error (propagates driver exceptions unchanged), test_client_supports_non_select_commands, test_client_uses_configured_connection_params. DatabricksClient takes connection params explicitly (host, token, http_path, warehouse_id) - does NOT read env vars (Config handles that). Uses databricks-sql-connector. Propagates driver exceptions unchanged. Interface: execute(sql: str) -\u003e None, fetchall(sql: str) -\u003e list[Row].","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-13T23:16:59.792345-05:00","updated_at":"2025-12-13T23:58:03.750799-05:00","closed_at":"2025-12-13T23:58:03.750799-05:00","dependencies":[{"issue_id":"ucmt-12f","depends_on_id":"ucmt-gwx","type":"blocks","created_at":"2025-12-13T23:17:02.45387-05:00","created_by":"daemon"}]}
{"id":"ucmt-15h","title":"Wire CLI run and status commands","description":"CLI run and status commands print 'not yet implemented'. Wire them: run should use Config + DatabricksClient + MigrationState + MigrationRunner to discover and execute pending migrations. status should query applied migrations from state table.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T23:51:10.727499-05:00","updated_at":"2025-12-14T00:17:11.957129-05:00","closed_at":"2025-12-14T00:02:19.744485-05:00"}
{"id":"ucmt-1kx","title":"Add close() method to DatabricksMigrationStateStore","description":"DatabricksMigrationStateStore creates connection in __init__ but never closes it. Add close() method and __enter__/__exit__ support.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-14T01:10:24.785489-05:00","updated_at":"2025-12-14T01:10:46.116799-05:00","dependencies":[{"issue_id":"ucmt-1kx","depends_on_id":"ucmt-zz6","type":"blocks","created_at":"2025-12-14T17:07:15.749028-05:00","created_by":"daemon"}]}
{"id":"ucmt-201","title":"Remove or integrate unused DeltaTypeRules","description":"DeltaTypeRules in models.py encapsulates type widening rules but is only used in tests. Actual validation is duplicated in diff.py _validate_type_change. Either integrate DeltaTypeRules into _validate_type_change, or delete it (YAGNI). Location: src/ucmt/schema/models.py:8-40","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-14T17:03:37.735196-05:00","updated_at":"2025-12-14T17:03:37.735196-05:00","dependencies":[{"issue_id":"ucmt-201","depends_on_id":"ucmt-5mz","type":"blocks","created_at":"2025-12-14T17:07:54.793824-05:00","created_by":"daemon"}]}
{"id":"ucmt-21y","title":"Add ucmt lint command - detect dangerous migration patterns","description":"Atlas-inspired feature: Analyze generated migrations for dangerous patterns before applying. Detect: DROP TABLE/COLUMN without backup strategy, type narrowing attempts, NOT NULL additions without defaults, operations that require table locks. Exit non-zero if issues found. Usage: ucmt lint sql/migrations/","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-14T01:44:55.115926-05:00","updated_at":"2025-12-14T01:44:55.115926-05:00","dependencies":[{"issue_id":"ucmt-21y","depends_on_id":"ucmt-jkm","type":"related","created_at":"2025-12-14T17:07:38.187006-05:00","created_by":"daemon"}]}
{"id":"ucmt-2by","title":"Delete duplicate legacy modules (runner.py, state.py, client.py)","description":"Legacy modules src/ucmt/runner.py, src/ucmt/state.py, src/ucmt/client.py are unused. CLI and tests use ucmt.migrations.* instead. Legacy state uses string interpolation (less safe). Delete all three after fixing ucmt-4ci.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-14T01:10:24.447501-05:00","updated_at":"2025-12-14T01:15:56.294713-05:00","closed_at":"2025-12-14T01:15:56.294713-05:00"}
{"id":"ucmt-2go","title":"Add --online flag to validate command","description":"SchemaValidator exists but is not integrated into CLI. Add --online flag to 'ucmt validate' that: 1) Uses SchemaIntrospector to get current DB schema. 2) Calls SchemaValidator.validate(declared, db_schema). 3) Prints issues and exits 1 if not ok. Location: src/ucmt/cli.py cmd_validate, src/ucmt/schema/validator.py","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-14T17:03:32.717469-05:00","updated_at":"2025-12-14T17:03:32.717469-05:00","dependencies":[{"issue_id":"ucmt-2go","depends_on_id":"ucmt-0en","type":"blocks","created_at":"2025-12-14T17:05:08.854101-05:00","created_by":"daemon"},{"issue_id":"ucmt-2go","depends_on_id":"ucmt-zz6","type":"related","created_at":"2025-12-14T17:07:54.939011-05:00","created_by":"daemon"}]}
{"id":"ucmt-2i4","title":"YAML Schema Loader (schema/loader.py): Parse schema YAML files into models","description":"TDD tests (write FIRST): test_loader_users_yaml_golden, test_loader_transactions_yaml_golden, test_loader_schema_dir_multiple_tables, test_loader_missing_table_field_raises_SchemaLoadError, test_loader_missing_column_name_raises_SchemaLoadError, test_loader_missing_column_type_raises_SchemaLoadError, test_loader_unknown_field_raises_SchemaLoadError, test_loader_validates_liquid_clustering_max_4_cols, test_loader_duplicate_column_names_raises_SchemaLoadError, test_loader_duplicate_table_names_raises_SchemaLoadError, test_loader_defaults, test_loader_parses_foreign_key_to_model. Import SchemaLoadError from ucmt.exceptions, Table/Column from ucmt.schema.models. ForeignKey IS parsed into Column.foreign_key (for documentation) but not used by diff. YAML description -\u003e Table.description, YAML comment -\u003e Table.comment.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-13T23:16:29.895673-05:00","updated_at":"2025-12-14T00:12:57.717976-05:00","closed_at":"2025-12-14T00:12:57.717976-05:00","dependencies":[{"issue_id":"ucmt-2i4","depends_on_id":"ucmt-yfk","type":"blocks","created_at":"2025-12-13T23:16:32.47138-05:00","created_by":"daemon"}]}
{"id":"ucmt-2k5","title":"Runner: failed migrations block retries permanently","description":"Current Runner semantics: failed migrations are marked as 'applied' (success=False) and plan() skips them because has_applied() returns True.\n\nThis means a migration that fails once can never be retried without manual intervention (deleting from state table or editing migration file).\n\nConsider adding:\n- retry_failed flag to plan()/apply()\n- Or only treat success=True as 'applied' in has_applied()\n\nDocument current behavior at minimum.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-14T00:38:57.01443-05:00","updated_at":"2025-12-14T00:38:57.01443-05:00"}
{"id":"ucmt-2q1","title":"Add ucmt check command - verify schema is in sync with DB","description":"Alembic-inspired feature: Add a check command that verifies whether the declared YAML schema matches the database state. Returns exit code 0 if in sync, 1 if changes detected. Useful as a CI/CD gate. Reuses existing diff logic - just need to return appropriate exit code based on whether changes exist. Usage: ucmt check --online","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-14T01:43:07.630199-05:00","updated_at":"2025-12-14T01:43:16.952291-05:00","dependencies":[{"issue_id":"ucmt-2q1","depends_on_id":"ucmt-0z4","type":"blocks","created_at":"2025-12-14T17:05:08.803424-05:00","created_by":"daemon"},{"issue_id":"ucmt-2q1","depends_on_id":"ucmt-jkm","type":"related","created_at":"2025-12-14T17:07:38.040356-05:00","created_by":"daemon"}]}
{"id":"ucmt-40z","title":"Multi-catalog/schema support: 3-level schema directory structure","description":"Support catalog/schema/table directory structure (3 levels) instead of flat tables dir. Schema files organized as: schema/\u003ccatalog\u003e/\u003cschema\u003e/\u003ctable\u003e.yaml. CLI commands should accept --catalog and --schema flags or infer from directory structure. Enables managing multiple catalogs and schemas in a single repo.","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-14T01:02:50.417572-05:00","updated_at":"2025-12-14T01:02:50.417572-05:00"}
{"id":"ucmt-4ci","title":"Fix online introspection path - wrong DatabricksClient used","description":"_get_current_schema_online uses ucmt.client.DatabricksClient which lacks fetchall() method required by SchemaIntrospector. Any --online flag usage raises AttributeError. Fix: switch to ucmt.databricks.client.DatabricksClient.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-14T01:10:24.379796-05:00","updated_at":"2025-12-14T01:14:09.7421-05:00","closed_at":"2025-12-14T01:14:09.7421-05:00"}
{"id":"ucmt-4he","title":"Migration State Store (migrations/state.py): Track applied migrations","description":"Define MigrationStateStore Protocol in ucmt/migrations/state.py. Import MigrationStateConflictError from ucmt.exceptions. Methods: list_applied() -\u003e list[AppliedMigration] (ascending by version: int), get_last_applied() -\u003e Optional[AppliedMigration], record_applied(version: int, name: str, checksum: str, success: bool, error: Optional[str] = None), has_applied(version: int) -\u003e bool. AppliedMigration dataclass: version: int, name: str, checksum: str, applied_at: datetime, success: bool, error: Optional[str]. TDD tests: test_list_applied_returns_ascending_order, test_record_applied_success, test_record_applied_failure_with_error, test_get_last_applied, test_has_applied, test_record_same_version_twice_is_idempotent, test_record_different_checksum_same_version_raises_MigrationStateConflictError. InMemoryMigrationStateStore implements protocol.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-13T23:16:43.778576-05:00","updated_at":"2025-12-14T00:27:53.218593-05:00","closed_at":"2025-12-14T00:27:53.218593-05:00","dependencies":[{"issue_id":"ucmt-4he","depends_on_id":"ucmt-gwx","type":"blocks","created_at":"2025-12-13T23:16:46.270866-05:00","created_by":"daemon"},{"issue_id":"ucmt-4he","depends_on_id":"ucmt-d28","type":"blocks","created_at":"2025-12-13T23:38:32.731077-05:00","created_by":"daemon"}]}
{"id":"ucmt-4ix","title":"Validate foreign_key requires both table and column","description":"Add validation that foreign_key must be a dict and must specify both 'table' and 'column' fields. Raise SchemaLoadError if either is missing. TDD tests: test_loader_foreign_key_must_be_dict, test_loader_foreign_key_missing_table_raises, test_loader_foreign_key_missing_column_raises.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-14T00:23:51.742299-05:00","updated_at":"2025-12-14T00:23:51.742299-05:00","dependencies":[{"issue_id":"ucmt-4ix","depends_on_id":"ucmt-5ag","type":"blocks","created_at":"2025-12-14T17:07:23.958324-05:00","created_by":"daemon"}]}
{"id":"ucmt-56l","title":"Add integration test for full online diff flow","description":"Add integration-style test that exercises: Config-from-env → DatabricksClient → SchemaIntrospector → SchemaDiffer → MigrationGenerator. Use mocked fetchall responses for information_schema queries. Verify end-to-end correctness without real DB.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-14T01:11:22.378038-05:00","updated_at":"2025-12-14T01:11:43.352837-05:00","dependencies":[{"issue_id":"ucmt-56l","depends_on_id":"ucmt-jkm","type":"blocks","created_at":"2025-12-14T17:07:44.752479-05:00","created_by":"daemon"}]}
{"id":"ucmt-5ag","title":"Add type validation for loader fields","description":"Add isinstance checks for: columns (must be list), liquid_clustering (must be list), partitioned_by (must be list), table_properties (must be dict), primary_key (must be dict), check_constraints (must be list), column name/type (must be strings). TDD tests: test_loader_columns_must_be_list, test_loader_liquid_clustering_must_be_list, test_loader_table_properties_must_be_dict, test_loader_column_name_must_be_string.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-14T00:23:47.15437-05:00","updated_at":"2025-12-14T00:23:47.15437-05:00"}
{"id":"ucmt-5em","title":"Fix brittle row handling in SchemaIntrospector","description":"_row_get helper exists for safe row access but _fetch_table_info and _fetch_columns use direct row['key'] which fails if rows aren't dicts. Use _row_get consistently.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-14T01:10:24.583386-05:00","updated_at":"2025-12-14T17:13:42.128639-05:00","closed_at":"2025-12-14T17:13:42.128639-05:00"}
{"id":"ucmt-5mz","title":"Remove duplicate SchemaChange from types.py","description":"SchemaChange is defined in both types.py and schema/diff.py. Only diff.py version is used by differ/codegen. Remove from types.py to avoid divergence.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-14T01:10:24.51486-05:00","updated_at":"2025-12-14T17:11:16.050633-05:00","closed_at":"2025-12-14T17:11:16.050633-05:00"}
{"id":"ucmt-5rd","title":"Databricks State Store (migrations/state.py DatabricksMigrationStateStore)","description":"TDD tests (write FIRST): test_creates_state_table_if_missing, test_reads_applied_migrations, test_records_success, test_records_failure, test_state_table_fqn_from_config. State table DDL: version INT, name STRING, checksum STRING, applied_at TIMESTAMP, success BOOLEAN, error STRING. Table name: ${catalog}.${schema}.__ucmt_migrations. Must satisfy MigrationStateStore protocol from ucmt-4he with version as int. Handle concurrent table creation (CREATE TABLE IF NOT EXISTS). DatabricksMigrationStateStore receives connection params from Config, does not read env vars directly.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-13T23:17:06.56703-05:00","updated_at":"2025-12-14T00:44:32.283612-05:00","closed_at":"2025-12-14T00:44:32.283612-05:00","dependencies":[{"issue_id":"ucmt-5rd","depends_on_id":"ucmt-12f","type":"blocks","created_at":"2025-12-13T23:17:09.79959-05:00","created_by":"daemon"},{"issue_id":"ucmt-5rd","depends_on_id":"ucmt-4he","type":"blocks","created_at":"2025-12-13T23:17:12.350847-05:00","created_by":"daemon"}]}
{"id":"ucmt-5rr","title":"Harden SQL introspection against injection","description":"SchemaIntrospector uses f-string interpolation for catalog, schema, and table_name in SQL string literals. Fix: 1) Validate identifiers with regex (like state.py does). 2) Use parameterized queries for table_schema/table_name values. Location: src/ucmt/schema/introspect.py","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-14T17:03:27.66625-05:00","updated_at":"2025-12-14T17:03:27.66625-05:00","dependencies":[{"issue_id":"ucmt-5rr","depends_on_id":"ucmt-5em","type":"blocks","created_at":"2025-12-14T17:07:20.015848-05:00","created_by":"daemon"}]}
{"id":"ucmt-6i6","title":"Implement foreign key diff and codegen","description":"SchemaDiffer never compares foreign keys. MigrationGenerator has no handlers for ADD_FOREIGN_KEY/DROP_FOREIGN_KEY. Add _diff_foreign_keys to SchemaDiffer and generator methods to codegen (with 'informational only' comments since FKs are not enforced in Databricks).","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T23:50:58.218831-05:00","updated_at":"2025-12-13T23:50:58.218831-05:00","dependencies":[{"issue_id":"ucmt-6i6","depends_on_id":"ucmt-z19","type":"blocks","created_at":"2025-12-14T17:07:29.214733-05:00","created_by":"daemon"}]}
{"id":"ucmt-7t8","title":"Add ucmt apply command - declarative one-step apply","description":"Atlas-inspired feature: Combine diff + generate + run into single declarative command. Compares schema YAML to DB, generates migration, and applies it in one step. For rapid development workflows. Usage: ucmt apply --online (with confirmation prompt unless --yes)","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-14T01:45:14.129538-05:00","updated_at":"2025-12-14T01:45:14.129538-05:00","dependencies":[{"issue_id":"ucmt-7t8","depends_on_id":"ucmt-0z4","type":"blocks","created_at":"2025-12-14T17:05:13.752114-05:00","created_by":"daemon"},{"issue_id":"ucmt-7t8","depends_on_id":"ucmt-2q1","type":"related","created_at":"2025-12-14T17:07:55.010779-05:00","created_by":"daemon"}]}
{"id":"ucmt-8fp","title":"Add ucmt stamp command - mark migrations as applied without running","description":"Alembic-inspired feature: Add a stamp command that marks migrations as applied in the state table without actually executing them. Useful for: (1) adopting UCMT on existing databases, (2) recovering from manual interventions, (3) testing. Usage: ucmt stamp V005 or ucmt stamp --all","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-14T01:43:07.702272-05:00","updated_at":"2025-12-14T01:43:17.006318-05:00","dependencies":[{"issue_id":"ucmt-8fp","depends_on_id":"ucmt-5rd","type":"blocks","created_at":"2025-12-14T17:05:03.698054-05:00","created_by":"daemon"},{"issue_id":"ucmt-8fp","depends_on_id":"ucmt-jkm","type":"related","created_at":"2025-12-14T17:07:38.079215-05:00","created_by":"daemon"}]}
{"id":"ucmt-8pt","title":"Add unit tests for cmd_status and cmd_run","description":"cmd_status and cmd_run have no unit tests. Add tests with mocked state store and executor covering: no migrations, pending/applied counts, --dry-run, error handling.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-14T01:10:24.850589-05:00","updated_at":"2025-12-14T01:10:46.176189-05:00","dependencies":[{"issue_id":"ucmt-8pt","depends_on_id":"ucmt-rpb","type":"blocks","created_at":"2025-12-14T17:07:44.666149-05:00","created_by":"daemon"}]}
{"id":"ucmt-8zf","title":"Databricks import in state.py hurts testability","description":"","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-14T00:57:43.713573-05:00","updated_at":"2025-12-14T00:57:43.713573-05:00","dependencies":[{"issue_id":"ucmt-8zf","depends_on_id":"ucmt-1kx","type":"blocks","created_at":"2025-12-14T17:07:15.824478-05:00","created_by":"daemon"}]}
{"id":"ucmt-a4g","title":"Integrate new Runner into CLI (replace old MigrationRunner)","description":"CLI uses old ucmt.runner.MigrationRunner and ucmt.state.MigrationState. Need to:\n1. Wire cmd_status and cmd_run to use new ucmt.migrations.runner.Runner\n2. Create DatabricksMigrationStateStore that implements MigrationStateStore protocol\n3. Use parse_migrations_dir instead of runner.discover_migrations\n4. Remove old ucmt.runner and ucmt.state modules after migration\n5. Update imports in cli.py\n\nDependencies: ucmt-5rd (Databricks State Store)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-14T00:38:40.059748-05:00","updated_at":"2025-12-14T00:45:48.449598-05:00","closed_at":"2025-12-14T00:45:48.449598-05:00"}
{"id":"ucmt-aaz","title":"Fix unused import in cli.py:219 (ruff F401)","description":"cli.py:219 imports databricks_sql but never uses it in cmd_status. Ruff flags F401. Remove the import - DatabricksMigrationStateStore handles ImportError.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-14T01:10:24.718989-05:00","updated_at":"2025-12-14T01:10:46.059742-05:00"}
{"id":"ucmt-bzi","title":"Add ucmt history command - show migration history with timestamps","description":"Show full migration history from state table with applied timestamps, duration, and success/failure status. Useful for debugging and auditing. Usage: ucmt history","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-14T01:44:55.181217-05:00","updated_at":"2025-12-14T01:44:55.181217-05:00","dependencies":[{"issue_id":"ucmt-bzi","depends_on_id":"ucmt-5rd","type":"blocks","created_at":"2025-12-14T17:05:03.79949-05:00","created_by":"daemon"},{"issue_id":"ucmt-bzi","depends_on_id":"ucmt-jkm","type":"related","created_at":"2025-12-14T17:07:38.150276-05:00","created_by":"daemon"}]}
{"id":"ucmt-c87","title":"Add data loss warnings to generate command","description":"Prisma-inspired feature: When generating migrations, explicitly warn about potential data loss. Show warnings like: ⚠ DROP COLUMN users.email will delete data / ⚠ ALTER COLUMN users.age to NOT NULL may fail if nulls exist. Require --allow-data-loss flag to proceed (in addition to existing --allow-destructive).","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-14T01:45:06.045649-05:00","updated_at":"2025-12-14T01:45:06.045649-05:00","dependencies":[{"issue_id":"ucmt-c87","depends_on_id":"ucmt-6i6","type":"blocks","created_at":"2025-12-14T17:07:29.255425-05:00","created_by":"daemon"}]}
{"id":"ucmt-csz","title":"Define IDbSession protocol for pluggable backends","description":"Define Protocol: class IDbSession(Protocol): def fetchall(sql) -\u003e list[dict]; def execute(sql) -\u003e None. Implement DatabricksSession(IDbSession). Have SchemaIntrospector, DatabricksMigrationStateStore, and runner depend only on IDbSession. Enables future backends (Spark-connect, mock for testing).","status":"open","priority":4,"issue_type":"feature","created_at":"2025-12-14T01:11:22.509013-05:00","updated_at":"2025-12-14T01:11:22.509013-05:00"}
{"id":"ucmt-d1h","title":"Add SchemaDiffer and MigrationGenerator unit tests","description":"Add unit tests for SchemaDiffer (test change detection, destructive/unsupported flags) and MigrationGenerator (compare generated SQL to golden files in tests/fixtures/golden_sql/).","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T23:51:10.858332-05:00","updated_at":"2025-12-13T23:51:10.858332-05:00","dependencies":[{"issue_id":"ucmt-d1h","depends_on_id":"ucmt-z19","type":"blocks","created_at":"2025-12-14T17:07:44.711127-05:00","created_by":"daemon"}]}
{"id":"ucmt-d28","title":"Shared Types \u0026 Exceptions (ucmt/types.py, ucmt/exceptions.py)","description":"Define all shared types and exceptions in central location. ucmt/types.py: SchemaChange(change_type: ChangeType, table_name: str, details: dict[str, Any], is_destructive: bool = False, is_unsupported: bool = False, error_message: Optional[str] = None, requires_column_mapping: bool = False). ucmt/exceptions.py: UcmtError(Exception) base, SchemaLoadError(UcmtError), MigrationParseError(UcmtError), MigrationStateConflictError(UcmtError), MigrationChecksumMismatchError(UcmtError), ConfigError(UcmtError), UnsupportedSchemaChangeError(UcmtError). All other modules import from these. TDD: test_schema_change_fields, test_exception_hierarchy.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-13T23:36:51.678227-05:00","updated_at":"2025-12-13T23:58:03.735011-05:00","closed_at":"2025-12-13T23:58:03.735011-05:00","dependencies":[{"issue_id":"ucmt-d28","depends_on_id":"ucmt-gwx","type":"blocks","created_at":"2025-12-13T23:36:54.880474-05:00","created_by":"daemon"}]}
{"id":"ucmt-dgi","title":"Support shadow database for migration validation","description":"Add support for a shadow database (like Prisma's shadow database feature) to enable:\n\n- Validating migrations against a clean database state\n- Detecting drift between schema and migrations\n- Safe migration generation by comparing actual vs expected schema\n- Running migration dry-runs without affecting the main database\n\nThe shadow database is a temporary database created automatically to test migrations in isolation before applying them to the target database.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-14T01:41:14.399832-05:00","updated_at":"2025-12-14T01:41:19.183511-05:00","dependencies":[{"issue_id":"ucmt-dgi","depends_on_id":"ucmt-0z4","type":"blocks","created_at":"2025-12-14T17:05:13.801787-05:00","created_by":"daemon"},{"issue_id":"ucmt-dgi","depends_on_id":"ucmt-5rr","type":"blocks","created_at":"2025-12-14T17:07:54.97293-05:00","created_by":"daemon"}]}
{"id":"ucmt-fby","title":"CLI: Add databricks connector check to cmd_run","description":"cmd_status and cmd_plan check for databricks-sql-connector ImportError and give helpful message. cmd_run does not, giving opaque error. Add same check for consistency.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-14T01:30:40.562342-05:00","updated_at":"2025-12-14T01:30:40.562342-05:00","dependencies":[{"issue_id":"ucmt-fby","depends_on_id":"ucmt-od3","type":"blocks","created_at":"2025-12-14T17:07:37.890167-05:00","created_by":"daemon"}]}
{"id":"ucmt-fy5","title":"CLI Module (cli.py): Command-line interface","description":"TDD tests (write FIRST): test_cli_help_shows_all_commands, test_cli_apply_invokes_runner, test_cli_generate_creates_migration_file, test_cli_validate_exits_nonzero_on_drift, test_cli_diff_prints_changes_no_execution, test_cli_plan_lists_pending, test_cli_status_shows_applied_and_pending, test_cli_exits_0_on_success, test_cli_exits_1_on_error, test_cli_config_error_exits_2, test_cli_validation_failure_exits_1, test_cli_respects_config_precedence, test_cli_requires_allow_destructive_for_drops. Exit codes: 0=success, 1=runtime/validation error, 2=config error. CLI entrypoint 'ucmt'. Commands: schema validate, migrations generate/diff/plan/apply/status. Destructive detection: SchemaChange.is_destructive OR SQL contains DROP TABLE/DROP COLUMN. --allow-destructive required.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-13T23:17:32.652234-05:00","updated_at":"2025-12-14T01:27:27.906615-05:00","closed_at":"2025-12-14T01:27:27.906615-05:00","dependencies":[{"issue_id":"ucmt-fy5","depends_on_id":"ucmt-vqt","type":"blocks","created_at":"2025-12-13T23:17:35.606111-05:00","created_by":"daemon"},{"issue_id":"ucmt-fy5","depends_on_id":"ucmt-2i4","type":"blocks","created_at":"2025-12-13T23:17:38.294949-05:00","created_by":"daemon"},{"issue_id":"ucmt-fy5","depends_on_id":"ucmt-0z4","type":"blocks","created_at":"2025-12-13T23:17:40.972779-05:00","created_by":"daemon"},{"issue_id":"ucmt-fy5","depends_on_id":"ucmt-iyx","type":"blocks","created_at":"2025-12-13T23:17:43.553409-05:00","created_by":"daemon"},{"issue_id":"ucmt-fy5","depends_on_id":"ucmt-iir","type":"blocks","created_at":"2025-12-13T23:17:46.24784-05:00","created_by":"daemon"},{"issue_id":"ucmt-fy5","depends_on_id":"ucmt-5rd","type":"blocks","created_at":"2025-12-13T23:17:49.20082-05:00","created_by":"daemon"},{"issue_id":"ucmt-fy5","depends_on_id":"ucmt-0en","type":"blocks","created_at":"2025-12-13T23:21:46.768008-05:00","created_by":"daemon"},{"issue_id":"ucmt-fy5","depends_on_id":"ucmt-gwx","type":"blocks","created_at":"2025-12-13T23:32:46.28409-05:00","created_by":"daemon"}]}
{"id":"ucmt-gin","title":"DAB Integration: databricks.yml and wheel packaging","description":"TDD tests: test_dab_task_spec_uses_ucmt_entrypoint, test_dab_task_includes_catalog_schema_params, test_dab_paths_resolve_correctly. Create databricks.yml with python_wheel_task. Entry point: ucmt. Parameters: ['migrations', 'apply', '--catalog', '${var.catalog}', '--schema', '${var.schema}']. Helper function build_dab_task_spec(config) -\u003e dict for testability. Document: databricks bundle deploy installs wheel, job runs ucmt CLI. Paths: schema/ and sql/migrations/ relative to bundle root.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-13T23:17:53.759962-05:00","updated_at":"2025-12-13T23:26:43.128324-05:00","dependencies":[{"issue_id":"ucmt-gin","depends_on_id":"ucmt-fy5","type":"blocks","created_at":"2025-12-13T23:17:56.419913-05:00","created_by":"daemon"},{"issue_id":"ucmt-gin","depends_on_id":"ucmt-gwx","type":"blocks","created_at":"2025-12-13T23:32:49.188563-05:00","created_by":"daemon"},{"issue_id":"ucmt-gin","depends_on_id":"ucmt-ni1","type":"related","created_at":"2025-12-14T17:07:54.903174-05:00","created_by":"daemon"}]}
{"id":"ucmt-gph","title":"Delete ghost file hello.py","description":"hello.py at repo root is unused test file. Delete it.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-14T01:10:24.651009-05:00","updated_at":"2025-12-14T01:10:45.99588-05:00"}
{"id":"ucmt-gv9","title":"Runner: version field type mismatch (int vs str)","description":"New Runner uses version: int (from MigrationFile) but old MigrationRunner uses version: str. State table schema also has version as STRING.\n\nNeed to decide: \n- Keep version as int in new code (cleaner, matches V###__ pattern)\n- Or keep as str for backward compat with existing state tables\n\nIf keeping int, migration script needed for existing state tables.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-14T00:38:49.81124-05:00","updated_at":"2025-12-14T01:30:39.285748-05:00","closed_at":"2025-12-14T01:30:39.285748-05:00"}
{"id":"ucmt-gwx","title":"Project Setup: pyproject.toml, package structure, pytest config","description":"Create src/ucmt/ package structure with __init__.py files for: ucmt, ucmt.schema, ucmt.migrations, ucmt.databricks. pyproject.toml with: name='ucmt', [project.scripts] ucmt='ucmt.cli:main', dependencies=[pyyaml, databricks-sql-connector]. pytest config in pyproject.toml. tests/ directory with tests/unit/, tests/integration/, tests/fixtures/. Fixtures: tests/fixtures/schema/tables/users.yaml, transactions.yaml matching docs/initial_plan.md examples exactly. tests/fixtures/golden_sql/ for codegen golden files. Module import DAG (no cycles): types.py \u003c- exceptions.py \u003c- models.py \u003c- loader.py/introspect.py \u003c- diff.py \u003c- codegen.py. config.py standalone. client.py standalone. state.py \u003c- runner.py. cli.py imports all.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-13T23:16:03.070945-05:00","updated_at":"2025-12-13T23:47:15.471944-05:00","closed_at":"2025-12-13T23:47:15.471944-05:00"}
{"id":"ucmt-hxh","title":"Remove duplicate runner/state modules after CLI integration","description":"After ucmt-a4g is complete, remove:\n- src/ucmt/runner.py (old MigrationRunner)\n- src/ucmt/state.py (old MigrationState)\n\nThese are superseded by:\n- src/ucmt/migrations/runner.py\n- src/ucmt/migrations/state.py\n\nBlocked by: ucmt-a4g","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-14T00:39:02.322141-05:00","updated_at":"2025-12-14T17:04:45.223966-05:00","closed_at":"2025-12-14T17:04:45.223966-05:00"}
{"id":"ucmt-iir","title":"Migration Runner (migrations/runner.py): Apply migrations in order","description":"TDD tests (write FIRST): test_plan_returns_pending_only, test_plan_skips_already_applied, test_apply_executes_in_version_order, test_apply_records_each_success, test_apply_stops_on_first_failure_and_records_error, test_apply_checksum_mismatch_raises_MigrationChecksumMismatchError_before_execution, test_apply_logs_each_migration, test_apply_no_pending_logs_up_to_date, test_plan_is_pure_function, test_dry_run_executes_nothing. Import MigrationChecksumMismatchError from ucmt.exceptions. PendingMigration dataclass: version: int, name: str, path: Path, checksum: str, sql: str. Runner uses abstract StateStore protocol. plan() is pure: (list[MigrationFile], StateStore) -\u003e list[PendingMigration]. apply() executes and updates state. Variable substitution: runner substitutes ${catalog}/${schema} with Config values before execution.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-13T23:16:50.30251-05:00","updated_at":"2025-12-14T00:36:53.922414-05:00","closed_at":"2025-12-14T00:36:53.922414-05:00","dependencies":[{"issue_id":"ucmt-iir","depends_on_id":"ucmt-w5z","type":"blocks","created_at":"2025-12-13T23:16:52.849533-05:00","created_by":"daemon"},{"issue_id":"ucmt-iir","depends_on_id":"ucmt-4he","type":"blocks","created_at":"2025-12-13T23:16:55.542084-05:00","created_by":"daemon"}]}
{"id":"ucmt-irq","title":"Extract MigrationService facade for programmatic API","description":"Create MigrationService class that owns config, client, state store, introspector, generator. Methods: diff(declared, online) -\u003e list[SchemaChange], generate(changes, description) -\u003e str, apply(migrations_dir, dry_run) -\u003e ApplyResult. Makes CLI a thin wrapper and enables library usage. Consider only if embedding as library is needed.","status":"open","priority":4,"issue_type":"feature","created_at":"2025-12-14T01:11:22.442385-05:00","updated_at":"2025-12-14T01:11:22.442385-05:00","dependencies":[{"issue_id":"ucmt-irq","depends_on_id":"ucmt-syo","type":"blocks","created_at":"2025-12-14T17:07:54.86749-05:00","created_by":"daemon"}]}
{"id":"ucmt-iyx","title":"SQL Codegen (schema/codegen.py): Generate SQL migrations from SchemaChanges","description":"TDD tests (write FIRST): test_codegen_create_table_golden, test_codegen_primary_key_syntax, test_codegen_add_column, test_codegen_drop_column_marks_destructive, test_codegen_alter_column_type, test_codegen_alter_table_properties, test_codegen_add_check_constraint, test_codegen_drop_check_constraint, test_codegen_fqn_uses_dollar_braces, test_codegen_destructive_warning_header, test_codegen_unsupported_change_raises_UnsupportedSchemaChangeError, test_codegen_empty_changes_returns_header_only, test_codegen_escapes_single_quotes, test_codegen_uses_table_comment_not_description, test_codegen_no_foreign_key_sql, test_codegen_timestamp_line_format. Import from ucmt.types, ucmt.exceptions. Raises UnsupportedSchemaChangeError (not ValueError) when is_unsupported=True. No FK SQL generated. Tests assert timestamp line starts with '-- Generated:' (don't match exact time). Use MigrationGenerator._now() for testability (default datetime.now).","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-13T23:16:22.6427-05:00","updated_at":"2025-12-14T00:14:28.212312-05:00","closed_at":"2025-12-14T00:14:28.212312-05:00","dependencies":[{"issue_id":"ucmt-iyx","depends_on_id":"ucmt-vxw","type":"blocks","created_at":"2025-12-13T23:16:25.212995-05:00","created_by":"daemon"}]}
{"id":"ucmt-jh7","title":"Race condition in DatabricksMigrationStateStore.record_applied","description":"","status":"open","priority":3,"issue_type":"bug","created_at":"2025-12-14T00:57:38.062517-05:00","updated_at":"2025-12-14T00:57:38.062517-05:00","dependencies":[{"issue_id":"ucmt-jh7","depends_on_id":"ucmt-1kx","type":"blocks","created_at":"2025-12-14T17:07:15.786209-05:00","created_by":"daemon"}]}
{"id":"ucmt-jkm","title":"Extract CLI helpers to ucmt/databricks/utils.py","description":"Move DB connection logic from CLI to dedicated module. Create: build_config_from_env_and_validate(), get_online_schema(config), split_sql_statements(sql). Makes CLI a thin orchestration layer and enables programmatic API.","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-14T01:11:22.315159-05:00","updated_at":"2025-12-14T17:17:33.132901-05:00","dependencies":[{"issue_id":"ucmt-jkm","depends_on_id":"ucmt-nho","type":"blocks","created_at":"2025-12-14T17:07:37.963849-05:00","created_by":"daemon"}]}
{"id":"ucmt-kfl","title":"CLI: Expand test coverage for error paths","description":"Add tests for: cmd_diff online mode, ConfigError in diff/generate, missing databricks connector in status/plan/run, cmd_run dry-run behavior, plan command in help output.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-14T01:30:40.635818-05:00","updated_at":"2025-12-14T01:30:40.635818-05:00","dependencies":[{"issue_id":"ucmt-kfl","depends_on_id":"ucmt-ni1","type":"blocks","created_at":"2025-12-14T17:07:44.623601-05:00","created_by":"daemon"}]}
{"id":"ucmt-ljm","title":"Add ucmt visualize command - generate ERD from schema","description":"Atlas-inspired feature: Generate Mermaid ERD diagram from YAML schema files. Useful for documentation and understanding table relationships. Output formats: mermaid (default), or open in browser. Usage: ucmt visualize --format mermaid \u003e erd.md","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-14T01:45:06.110584-05:00","updated_at":"2025-12-14T01:45:06.110584-05:00","dependencies":[{"issue_id":"ucmt-ljm","depends_on_id":"ucmt-2i4","type":"blocks","created_at":"2025-12-14T17:05:13.853233-05:00","created_by":"daemon"}]}
{"id":"ucmt-lxy","title":"Use Column.check in CREATE TABLE codegen","description":"Loader populates Column.check from YAML but codegen never uses it in _gen_create_table. Either generate inline CHECK constraints or document that column-level checks are descriptive only.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T23:51:10.658957-05:00","updated_at":"2025-12-13T23:51:10.658957-05:00","dependencies":[{"issue_id":"ucmt-lxy","depends_on_id":"ucmt-6i6","type":"blocks","created_at":"2025-12-14T17:07:29.293314-05:00","created_by":"daemon"}]}
{"id":"ucmt-mvz","title":"Logic duplication between cmd_status and Runner.plan","description":"","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-14T00:57:43.778488-05:00","updated_at":"2025-12-14T00:57:43.778488-05:00","dependencies":[{"issue_id":"ucmt-mvz","depends_on_id":"ucmt-2k5","type":"blocks","created_at":"2025-12-14T17:07:44.582688-05:00","created_by":"daemon"}]}
{"id":"ucmt-nho","title":"CLI: Add ConfigError handling to cmd_diff and cmd_generate","description":"cmd_diff and cmd_generate catch ConfigError in generic except block and return 1. Should explicitly catch ConfigError and return 2 for consistency with status/plan/run.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-14T01:30:40.496433-05:00","updated_at":"2025-12-14T01:30:40.496433-05:00","dependencies":[{"issue_id":"ucmt-nho","depends_on_id":"ucmt-fby","type":"blocks","created_at":"2025-12-14T17:07:37.927282-05:00","created_by":"daemon"}]}
{"id":"ucmt-ni1","title":"Consolidate duplicate config validation logic","description":"Two validation mechanisms exist: Config.validate_for_db_ops() raises ConfigError, while _validate_db_config() prints and returns bool. Consolidate to single approach - prefer validate_for_db_ops with CLI catching exception. Location: src/ucmt/config.py:65-84, src/ucmt/cli.py:16-36","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-14T17:03:43.473588-05:00","updated_at":"2025-12-14T17:03:43.473588-05:00","dependencies":[{"issue_id":"ucmt-ni1","depends_on_id":"ucmt-jkm","type":"blocks","created_at":"2025-12-14T17:07:38.003065-05:00","created_by":"daemon"}]}
{"id":"ucmt-od3","title":"Double DB connections in cmd_run","description":"","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-14T00:57:43.652223-05:00","updated_at":"2025-12-14T00:57:43.652223-05:00","dependencies":[{"issue_id":"ucmt-od3","depends_on_id":"ucmt-vcd","type":"blocks","created_at":"2025-12-14T17:07:37.849975-05:00","created_by":"daemon"}]}
{"id":"ucmt-oet","title":"Archive or update stale docs/initial_plan.md","description":"docs/initial_plan.md is ~1150 lines with code snippets that diverge from actual implementation. Mark as archived/historical or update it.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-14T01:10:24.916818-05:00","updated_at":"2025-12-14T01:10:46.23502-05:00"}
{"id":"ucmt-of1","title":"Add ucmt resolve command - mark failed migrations as resolved","description":"Prisma-inspired feature: When a migration partially fails or is manually fixed, mark it as resolved without re-running. Useful for recovering from production incidents. Usage: ucmt resolve V005 --applied or ucmt resolve V005 --rolled-back","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-14T01:44:55.243962-05:00","updated_at":"2025-12-14T01:44:55.243962-05:00","dependencies":[{"issue_id":"ucmt-of1","depends_on_id":"ucmt-5rd","type":"blocks","created_at":"2025-12-14T17:05:03.749195-05:00","created_by":"daemon"},{"issue_id":"ucmt-of1","depends_on_id":"ucmt-jkm","type":"related","created_at":"2025-12-14T17:07:38.116177-05:00","created_by":"daemon"}]}
{"id":"ucmt-rb7","title":"Add migration integrity file (atlas.sum equivalent)","description":"Atlas-inspired feature: Generate a checksum file (e.g., migrations.sum) that tracks the hash of all migration files. Detect if migrations have been edited or deleted after being applied. Fail fast if integrity check fails. Protects against accidental/malicious modification of migration history.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-14T01:45:14.065918-05:00","updated_at":"2025-12-14T01:45:14.065918-05:00","dependencies":[{"issue_id":"ucmt-rb7","depends_on_id":"ucmt-21y","type":"related","created_at":"2025-12-14T17:07:55.048063-05:00","created_by":"daemon"}]}
{"id":"ucmt-rh5","title":"Integration Tests: End-to-end workflow validation","description":"TDD tests: test_roundtrip_yaml_to_db_produces_no_diff, test_generate_then_apply_workflow, test_full_lifecycle_create_table, test_full_lifecycle_add_column, test_full_lifecycle_unsupported_change_blocks_apply, test_local_and_databricks_produce_same_sql, test_variable_substitution_works. Use tests/fixtures/ for YAML and tests/fixtures/golden_sql/ for expected SQL output. Mock DatabricksClient. Golden SQL tests: assert exact match except timestamp line (check prefix only). Test variable substitution: ${catalog}.${schema} replaced with actual values before execution. All tests run without real Databricks.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-13T23:18:00.593318-05:00","updated_at":"2025-12-13T23:38:29.006056-05:00","dependencies":[{"issue_id":"ucmt-rh5","depends_on_id":"ucmt-fy5","type":"blocks","created_at":"2025-12-13T23:18:03.192012-05:00","created_by":"daemon"},{"issue_id":"ucmt-rh5","depends_on_id":"ucmt-56l","type":"blocks","created_at":"2025-12-14T17:07:44.79408-05:00","created_by":"daemon"}]}
{"id":"ucmt-rpb","title":"Status command hides failed migrations","description":"","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-14T00:57:37.999449-05:00","updated_at":"2025-12-14T17:21:03.7398-05:00","closed_at":"2025-12-14T17:21:03.7398-05:00","dependencies":[{"issue_id":"ucmt-rpb","depends_on_id":"ucmt-zz6","type":"blocks","created_at":"2025-12-14T17:07:15.859977-05:00","created_by":"daemon"}]}
{"id":"ucmt-syo","title":"Add pluggable migration state store support","description":"Abstract state storage behind MigrationStateStore protocol (already exists). Add implementations for: LocalFileStateStore (JSON/SQLite for offline dev), S3/Delta state store. Useful for CI/CD pipelines without direct DB access.","status":"open","priority":4,"issue_type":"feature","created_at":"2025-12-14T01:11:22.573909-05:00","updated_at":"2025-12-14T01:11:22.573909-05:00","dependencies":[{"issue_id":"ucmt-syo","depends_on_id":"ucmt-csz","type":"blocks","created_at":"2025-12-14T17:07:54.830659-05:00","created_by":"daemon"}]}
{"id":"ucmt-t8c","title":"Harden YAML parsing: wrap YAMLError and validate top-level structure","description":"Wrap yaml.safe_load in try/except for YAMLError and raise SchemaLoadError with context. Add isinstance checks that top-level YAML is a dict, not a list or scalar. Add check that 'tables' field (if present) is a list. TDD tests: test_loader_yaml_parse_error_raises_SchemaLoadError, test_loader_non_mapping_yaml_top_level_raises_SchemaLoadError, test_loader_tables_field_must_be_list.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-14T00:23:42.188141-05:00","updated_at":"2025-12-14T01:33:08.358899-05:00","closed_at":"2025-12-14T01:33:08.358899-05:00"}
{"id":"ucmt-vcd","title":"Fix naive SQL statement splitting in CLI","description":"cmd_run uses sql.split(';') which breaks if semicolons appear in string literals. Either require one statement per migration file, or execute entire file content at once (simpler for Databricks). Location: src/ucmt/cli.py:380-383","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-14T17:03:47.986235-05:00","updated_at":"2025-12-14T17:03:47.986235-05:00","dependencies":[{"issue_id":"ucmt-vcd","depends_on_id":"ucmt-aaz","type":"blocks","created_at":"2025-12-14T17:07:37.813317-05:00","created_by":"daemon"}]}
{"id":"ucmt-vqt","title":"Config Module (config.py): Unified configuration","description":"TDD tests (write FIRST): test_config_loads_from_env, test_config_cli_overrides_env, test_config_defaults, test_config_missing_required_raises_ConfigError. Import ConfigError from ucmt.exceptions. Config dataclass: catalog: Optional[str], schema: Optional[str], schema_dir: str = 'schema', migrations_dir: str = 'sql/migrations', databricks_host: Optional[str], databricks_token: Optional[str], databricks_http_path: Optional[str], databricks_warehouse_id: Optional[str]. Env vars: UCMT_CATALOG, UCMT_SCHEMA, UCMT_SCHEMA_DIR, UCMT_MIGRATIONS_DIR, DATABRICKS_HOST, DATABRICKS_TOKEN, DATABRICKS_HTTP_PATH, DATABRICKS_WAREHOUSE_ID. Config.validate_for_db_ops() raises ConfigError if catalog/schema/connection missing. Config is ONLY env reader.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-13T23:17:26.045338-05:00","updated_at":"2025-12-14T01:09:05.276325-05:00","closed_at":"2025-12-14T01:09:05.276325-05:00","dependencies":[{"issue_id":"ucmt-vqt","depends_on_id":"ucmt-gwx","type":"blocks","created_at":"2025-12-13T23:17:28.671018-05:00","created_by":"daemon"},{"issue_id":"ucmt-vqt","depends_on_id":"ucmt-d28","type":"blocks","created_at":"2025-12-13T23:38:38.807828-05:00","created_by":"daemon"}]}
{"id":"ucmt-vxw","title":"Schema Diff Engine (schema/diff.py): Compare actual vs desired schema","description":"TDD tests (write FIRST): test_diff_create_new_table, test_diff_add_column, test_diff_drop_column, test_diff_unsupported_partition_change, test_diff_type_widening_allowed, test_diff_type_narrowing_blocked, test_diff_decimal_change_unsupported, test_diff_ordering_deterministic, test_diff_primary_key_changes, test_diff_check_constraints, test_diff_table_properties_only_set_never_drop, test_diff_liquid_clustering, test_diff_no_changes_is_empty, test_diff_drop_column_requires_column_mapping, test_diff_identical_schemas_returns_empty, test_diff_column_reorder_no_change, test_diff_ignores_extra_db_tables, test_diff_foreign_key_changes_ignored. ForeignKey parsed but NOT diffed in v1 (informational only). Import SchemaChange, ChangeType from ucmt.types. Properties: only set/overwrite. v1: no DROP_TABLE for extra DB tables. Stable ordering: change_type priority, table name, column name.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-13T23:16:15.674462-05:00","updated_at":"2025-12-14T00:07:18.710226-05:00","closed_at":"2025-12-14T00:07:18.710226-05:00","dependencies":[{"issue_id":"ucmt-vxw","depends_on_id":"ucmt-yfk","type":"blocks","created_at":"2025-12-13T23:16:18.375935-05:00","created_by":"daemon"}]}
{"id":"ucmt-w1w","title":"Connect introspection to CLI for online diff","description":"Current diff/generate commands compare declared schema vs empty Schema. Add --online flag or separate commands that use SchemaIntrospector to diff against actual database state. Document that current mode is 'offline'.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T23:51:10.791201-05:00","updated_at":"2025-12-14T00:47:26.045404-05:00","closed_at":"2025-12-14T00:47:26.045404-05:00"}
{"id":"ucmt-w5z","title":"Migration File Parser (migrations/parser.py): Parse V###__name.sql files","description":"TDD tests (write FIRST): test_parser_filename_extracts_version_and_name, test_parser_unpadded_version_allowed, test_parser_checksum_sha256_deterministic, test_parser_invalid_filename_raises_MigrationParseError, test_parser_multiple_statements_preserved_as_raw_text, test_parser_preserves_variable_placeholders, test_parser_sorts_by_numeric_version, test_parser_rejects_duplicate_versions_raises_MigrationParseError, test_parser_empty_file_raises_MigrationParseError, test_parser_missing_version_gap_allowed, test_parser_rejects_string_version. Import MigrationParseError from ucmt.exceptions. MigrationFile(version: int, name: str, path: Path, checksum: str, sql: str). Version is ALWAYS int (V001 -\u003e 1). Zero-padding is display only. Test that passing string version to APIs raises TypeError. Checksum: SHA256 of content with normalized \\n line endings.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-13T23:16:36.85939-05:00","updated_at":"2025-12-14T00:29:55.229252-05:00","closed_at":"2025-12-14T00:29:55.229252-05:00","dependencies":[{"issue_id":"ucmt-w5z","depends_on_id":"ucmt-gwx","type":"blocks","created_at":"2025-12-13T23:16:39.610581-05:00","created_by":"daemon"},{"issue_id":"ucmt-w5z","depends_on_id":"ucmt-d28","type":"blocks","created_at":"2025-12-13T23:38:35.759938-05:00","created_by":"daemon"}]}
{"id":"ucmt-wlg","title":"Add command to generate YAML migrations from existing schema","description":"Add a CLI command that introspects an existing database schema and generates YAML migration files representing the current state. These migrations should be marked as the starting point in the state table (already applied), enabling ucmt to manage future migrations from the current schema forward.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-14T01:24:25.298737-05:00","updated_at":"2025-12-14T01:24:29.211309-05:00","dependencies":[{"issue_id":"ucmt-wlg","depends_on_id":"ucmt-0z4","type":"blocks","created_at":"2025-12-14T17:05:08.9051-05:00","created_by":"daemon"}]}
{"id":"ucmt-yfk","title":"Schema Models (schema/models.py): Table, Column, PrimaryKey, ForeignKey, CheckConstraint, SchemaChange, ChangeType dataclasses","description":"Core domain types in ucmt/schema/models.py. Import ChangeType, SchemaChange from ucmt.types. TDD tests (write FIRST): test_models_basic, test_delta_type_rules_widening, test_pk_equality_requires_columns_and_rely_match, test_column_order_not_significant_for_table_equality, test_type_normalization_case_insensitive, test_decimal_precision_comparison. Dataclasses: Table (name: str, columns: list[Column], primary_key: Optional[PrimaryKey], check_constraints: list[CheckConstraint], liquid_clustering: list[str], partitioned_by: list[str], table_properties: dict[str,str], description: Optional[str], comment: Optional[str]), Column, PrimaryKey, ForeignKey, CheckConstraint. DeltaTypeRules: INT-\u003eBIGINT allowed, BIGINT-\u003eINT rejected. DECIMAL changes: v1 marks ALL DECIMAL precision/scale changes as unsupported for safety. Normalize types to uppercase.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-13T23:16:08.03265-05:00","updated_at":"2025-12-14T00:02:37.263935-05:00","closed_at":"2025-12-14T00:02:37.263935-05:00","dependencies":[{"issue_id":"ucmt-yfk","depends_on_id":"ucmt-gwx","type":"blocks","created_at":"2025-12-13T23:16:10.783098-05:00","created_by":"daemon"},{"issue_id":"ucmt-yfk","depends_on_id":"ucmt-d28","type":"blocks","created_at":"2025-12-13T23:36:57.791976-05:00","created_by":"daemon"}]}
{"id":"ucmt-ygt","title":"Add --sql flag to generate command for DBA handoff","description":"Alembic-inspired feature: Add --sql flag to generate command that outputs standalone SQL without any state tracking. Useful for DBA handoff in environments where direct execution is not allowed. The SQL should be self-contained and ready to execute. Usage: ucmt generate 'add users table' --sql \u003e migration.sql","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-14T01:43:07.77354-05:00","updated_at":"2025-12-14T01:43:17.059986-05:00"}
{"id":"ucmt-z19","title":"Enhanced diff output with column-level details","description":"Prisma-inspired feature: Improve diff output to show granular changes like Prisma does. Instead of just 'MODIFY_TABLE: users', show: [*] Changed table users / [+] Added column email / [-] Removed column legacy_id / [*] Altered column name (type changed). Makes reviewing changes much easier.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-14T01:45:05.97985-05:00","updated_at":"2025-12-14T01:45:05.97985-05:00"}
{"id":"ucmt-zz6","title":"DatabricksMigrationStateStore never closes DB connection","description":"","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-14T00:57:37.9326-05:00","updated_at":"2025-12-14T17:12:30.611304-05:00","closed_at":"2025-12-14T17:12:30.611304-05:00"}
